<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Prosty Kalkulator</title>
  <style>
    :root{
      --bg:#0f1724;
      --panel:#111827;
      --accent:#06b6d4;
      --muted:#9aa6b2;
      --btn:#1f2937;
      --btn-hover:#374151;
      --danger:#ef4444;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background:linear-gradient(180deg,#071127 0%,#0b1220 100%);
      color: #e6eef6;
      padding:20px;
    }
    .calculator{
      width:360px;
      max-width:100%;
      background:linear-gradient(180deg,var(--panel), #0b1220);
      border-radius:16px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.7);
      padding:18px;
    }
    .screen{
      background: rgba(255,255,255,0.03);
      border-radius:10px;
      padding:14px;
      min-height:84px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:flex-end;
      margin-bottom:12px;
      word-break:break-all;
    }
    .history{
      font-size:0.9rem;
      color:var(--muted);
      opacity:0.9;
      width:100%;
      text-align:right;
    }
    .display{
      font-size:1.6rem;
      font-weight:600;
      margin-top:6px;
      width:100%;
      text-align:right;
    }
    .keys{
      display:grid;
      grid-template-columns: repeat(4,1fr);
      gap:10px;
    }
    button{
      background:var(--btn);
      border: none;
      padding:18px 12px;
      border-radius:10px;
      font-size:1.05rem;
      color:inherit;
      cursor:pointer;
      box-shadow: 0 2px 6px rgba(2,6,23,0.6);
      transition: transform .06s ease, background .12s;
      user-select:none;
    }
    button:active{ transform: translateY(1px); }
    button:hover{ background:var(--btn-hover); }
    .op { background: linear-gradient(180deg,var(--accent), #0288a8); color:#021018; font-weight:700; }
    .wide { grid-column: span 2; }
    .danger { background:linear-gradient(180deg,var(--danger), #c22e2e); color:#fff; }
    .small { padding:12px; font-size:0.95rem; }
    footer{ margin-top:12px; font-size:0.85rem; color:var(--muted); text-align:center; }
    @media (max-width:380px){
      .calculator{ padding:12px; }
      button{ padding:14px 8px; font-size:1rem; }
      .display{ font-size:1.3rem; }
    }
  </style>
</head>
<body>
  <main class="calculator" role="application" aria-label="Prosty kalkulator">
    <div class="screen" aria-live="polite">
      <div class="history" id="history">&nbsp;</div>
      <div class="display" id="display">0</div>
    </div>

    <div class="keys" role="group" aria-label="Klawisze kalkulatora">
      <button class="small danger" data-action="clear">C</button>
      <button class="small" data-action="back">←</button>
      <button class="small" data-action="percent">%</button>
      <button class="op" data-action="operator">/</button>

      <button data-number="7">7</button>
      <button data-number="8">8</button>
      <button data-number="9">9</button>
      <button class="op" data-action="operator">*</button>

      <button data-number="4">4</button>
      <button data-number="5">5</button>
      <button data-number="6">6</button>
      <button class="op" data-action="operator">-</button>

      <button data-number="1">1</button>
      <button data-number="2">2</button>
      <button data-number="3">3</button>
      <button class="op" data-action="operator">+</button>

      <button data-number="0" class="wide">0</button>
      <button data-number=".">.</button>
      <button class="op" data-action="equals">=</button>
    </div>

    <footer>Prosty kalkulator — obsługuje + − × ÷, procent i cofanie. Możesz używać klawiatury.</footer>
  </main>

  <script>
    (function(){
      const displayEl = document.getElementById('display');
      const historyEl = document.getElementById('history');
      let current = "0";
      let previous = null;
      let operator = null;
      let overwrite = false;

      function updateDisplay(){
        displayEl.textContent = current;
        historyEl.textContent = previous !== null && operator ? `${previous} ${operator}` : '\u00A0';
      }

      function inputNumber(num){
        if(overwrite){
          current = (num === '.') ? '0.' : num;
          overwrite = false;
          return;
        }
        if(num === '.' && current.includes('.')) return;
        if(current === '0' && num !== '.') current = num;
        else current += num;
      }

      function chooseOperator(op){
        if(operator && !overwrite){
          compute();
        }
        operator = op;
        previous = current;
        overwrite = true;
      }

      function compute(){
        if(!operator || previous === null) return;
        const a = parseFloat(previous);
        const b = parseFloat(current);
        let res = 0;
        switch(operator){
          case '+': res = a + b; break;
          case '-': res = a - b; break;
          case '*': res = a * b; break;
          case '/': res = (b === 0) ? 'Błąd: dzielenie przez zero' : a / b; break;
        }
        current = (typeof res === 'number') ? String(roundResult(res)) : res;
        previous = null;
        operator = null;
        overwrite = true;
      }

      function roundResult(n){
        // ograniczamy do sensownej liczby miejsc po przecinku
        return Math.round((n + Number.EPSILON) * 1e10) / 1e10;
      }

      function clearAll(){
        current = "0"; previous = null; operator = null; overwrite = false;
      }

      function backspace(){
        if(overwrite){
          current = "0";
          overwrite = false;
          return;
        }
        if(current.length <= 1 || (current.length === 2 && current.startsWith('-'))){
          current = "0";
        } else {
          current = current.slice(0, -1);
        }
      }

      function percent(){
        const val = parseFloat(current);
        if(isNaN(val)) return;
        current = String(roundResult(val / 100));
        overwrite = true;
      }

      document.querySelectorAll('button').forEach(btn=>{
        btn.addEventListener('click', () => {
          const num = btn.dataset.number;
          const action = btn.dataset.action;

          if(num !== undefined){
            inputNumber(num);
            updateDisplay();
            return;
          }
          if(action){
            switch(action){
              case 'clear': clearAll(); break;
              case 'back': backspace(); break;
              case 'percent': percent(); break;
              case 'operator': chooseOperator(btn.textContent.trim()); break;
              case 'equals': compute(); break;
            }
            updateDisplay();
          }
        });
      });

      // Obsługa klawiatury
      window.addEventListener('keydown', (e) => {
        if(e.key >= '0' && e.key <= '9'){ inputNumber(e.key); updateDisplay(); return; }
        if(e.key === '.') { inputNumber('.'); updateDisplay(); return; }
        if(e.key === 'Enter' || e.key === '='){ compute(); updateDisplay(); return; }
        if(e.key === 'Backspace'){ backspace(); updateDisplay(); return; }
        if(e.key === 'Escape'){ clearAll(); updateDisplay(); return; }
        if(e.key === '%' ){ percent(); updateDisplay(); return; }
        if(['+','-','*','/'].includes(e.key)){ chooseOperator(e.key); updateDisplay(); return; }
      });

      // start
      updateDisplay();
    })();
  </script>
</body>
</html>

